#!/usr/local/bin/ruby -w

require 'optparse'
require 'flog'

options = {}
op = OptionParser.new do |opts|
  opts.on('-a', '--all', "display all flog results, not top 60%") do |a| 
    options[:all] = a
  end
  
  opts.on('-s', '--score', 'display total score only')  do |s| 
    options[:score] = s
  end
  
  opts.on('-m', '--methods-only', 'skip code outside of methods') do |m| 
    options[:methods] = m
  end
  
  opts.on("-I path1,path2,path3", Array, 'ruby include paths to search') do |list|
    options[:paths] = list.collect {|l| l.to_s }
  end
  
  opts.on('-v', '--verbose', 'verbosely display progress and errors')  do |v| 
    options[:verbose] = v
  end
  
  opts.on_tail('-h', '--help', 'show this message') do
    puts opts
    exit
  end
end.parse!

options[:paths].each {|dir| $: << dir } if options[:paths]

# we still need these, as the library is currently dependent upon these global variables
$a = true if options[:all]
$s = true if options[:score]
$m = true if options[:methods]
$v = true if options[:verbose]

$a ||= false
$m ||= false
$s ||= false
$v ||= false

ARGV.push "-" if ARGV.empty?

flogger = Flog.new
flogger.flog_files ARGV
flogger.report

exit 0
